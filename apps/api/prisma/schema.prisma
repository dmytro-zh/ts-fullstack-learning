datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Product {
  id            String        @id @default(cuid())
  name          String        @unique
  price         Float
  inStock       Boolean       @default(true)
  store         Store         @relation(fields: [storeId], references: [id])
  storeId       String
  cartItems     CartItem[]
  checkoutLinks CheckoutLink[]
  orders        Order[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  description   String?
  imageUrl      String?
  quantity  Int      @default(0)
}

model CartItem {
  id        String   @id @default(cuid())
  product   Product  @relation(fields: [productId], references: [id])
  productId String
  quantity  Int
  createdAt DateTime @default(now())

  @@index([productId])
}

enum OrderStatus {
  NEW
  PENDING
  PENDING_PAYMENT
  PAID
  PROCESSING
  SHIPPED
  COMPLETED
  CANCELLED
  REFUNDED
}

model Order {
  id              String      @id @default(cuid())
  customerName    String
  email           String
  shippingNote    String?
  quantity        Int         @default(1)
  total           Float
  status          OrderStatus @default(NEW)
  checkoutLinkId  String?
  storeId         String?
  productId       String
  product         Product     @relation(fields: [productId], references: [id])
  createdAt       DateTime    @default(now())
  shippingAddress String?

  @@index([checkoutLinkId])
  @@index([storeId])
}

model Store {
  id            String        @id @default(cuid())
  name          String
  email         String?
  products      Product[]
  checkoutLinks CheckoutLink[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  ownerId       String        @default("demo-owner-1")

  @@index([ownerId])
}

model CheckoutLink {
  id        String   @id @default(cuid())
  slug      String   @unique
  product   Product  @relation(fields: [productId], references: [id])
  productId String
  store     Store?   @relation(fields: [storeId], references: [id])
  storeId   String?
  active    Boolean  @default(true)
  createdAt DateTime @default(now())

  @@index([productId])
  @@index([storeId])
}
